#N canvas -11 -11 1920 970 12;
#N canvas -11 -11 1920 971 main 0;
#N canvas 81 340 846 406 init 0;
#X obj 42 27 loadbang;
#X msg 42 56 \; pd dsp 1;
#X obj 254 53 loadbang;
#X obj 254 82 samplerate~;
#X text 120 63 <-start DSP;
#X obj 254 26 table SE_recbuffer;
#X msg 254 140 \; SE_recbuffer resize \$1;
#X obj 254 111 * 300;
#X text 310 111 <-initialize the recording buffer size to 300s;
#X connect 0 0 1 0;
#X connect 2 0 3 0;
#X connect 3 0 7 0;
#X connect 7 0 6 0;
#X restore 66 98 pd init;
#N canvas -11 -11 1920 971 sub 0;
#X obj 37 130 outlet~;
#X text 229 46 <-The first argument determines the maximum number of
harmonic components;
#X obj 112 333 s SE_freq1_GUI;
#X obj 131 304 s SE_freq2_GUI;
#X obj 150 275 s SE_freq3_GUI;
#X obj 170 246 s SE_freq4_GUI;
#X obj 189 217 s SE_freq5_GUI;
#X obj 208 188 s SE_freq6_GUI;
#X obj 362 304 s SE_amp1_GUI;
#X obj 381 274 s SE_amp2_GUI;
#X obj 400 246 s SE_amp3_GUI;
#X obj 420 217 s SE_amp4_GUI;
#X obj 439 188 s SE_amp5_GUI;
#X obj 458 159 s SE_amp6_GUI;
#X obj 66 690 EM_mtos;
#X obj 66 719 s SE_note1_GUI;
#X obj 85 632 EM_mtos;
#X obj 104 574 EM_mtos;
#X obj 122 516 EM_mtos;
#X obj 142 458 EM_mtos;
#X obj 160 400 EM_mtos;
#X obj 85 661 s SE_note2_GUI;
#X obj 104 603 s SE_note3_GUI;
#X obj 122 545 s SE_note4_GUI;
#X obj 142 487 s SE_note5_GUI;
#X obj 160 429 s SE_note6_GUI;
#X obj 362 130 route 0 1 2 3 4 5;
#X obj 112 130 route 0 1 2 3 4 5;
#X obj 37 45 clone SEratio_voice 20;
#X connect 14 0 15 0;
#X connect 16 0 21 0;
#X connect 17 0 22 0;
#X connect 18 0 23 0;
#X connect 19 0 24 0;
#X connect 20 0 25 0;
#X connect 26 0 8 0;
#X connect 26 1 9 0;
#X connect 26 2 10 0;
#X connect 26 3 11 0;
#X connect 26 4 12 0;
#X connect 26 5 13 0;
#X connect 27 0 2 0;
#X connect 27 0 14 1;
#X connect 27 1 3 0;
#X connect 27 1 16 1;
#X connect 27 2 4 0;
#X connect 27 2 17 1;
#X connect 27 3 5 0;
#X connect 27 3 18 1;
#X connect 27 4 6 0;
#X connect 27 4 19 1;
#X connect 27 5 7 0;
#X connect 27 5 20 1;
#X connect 28 0 0 0;
#X connect 28 1 27 0;
#X connect 28 2 26 0;
#X restore 65 157 pd sub;
#X obj 338 224 nbx 5 14 -1e+037 1e+037 0 0 empty SE_freq1_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 398 224 nbx 5 14 -1e+037 1e+037 0 0 empty SE_freq2_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 458 224 nbx 5 14 -1e+037 1e+037 0 0 empty SE_freq3_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 518 224 nbx 5 14 -1e+037 1e+037 0 0 empty SE_freq4_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 578 224 nbx 5 14 -1e+037 1e+037 0 0 empty SE_freq5_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 638 224 nbx 5 14 -1e+037 1e+037 0 0 empty SE_freq6_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X text 224 222 Component Freq:;
#X obj 338 276 nbx 5 14 -1e+037 1e+037 0 0 empty SE_amp1_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 398 276 nbx 5 14 -1e+037 1e+037 0 0 empty SE_amp2_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 458 276 nbx 5 14 -1e+037 1e+037 0 0 empty SE_amp3_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 518 276 nbx 5 14 -1e+037 1e+037 0 0 empty SE_amp4_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 578 276 nbx 5 14 -1e+037 1e+037 0 0 empty SE_amp5_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 638 276 nbx 5 14 -1e+037 1e+037 0 0 empty SE_amp6_GUI empty
0 -8 0 10 -262144 -1 -1 0 256;
#X obj 65 301 outlet~;
#X obj 338 152 nbx 5 14 0 20000 0 0 empty empty empty -90 5 0 10 -262144
-1 -1 0 256;
#X obj 338 176 nbx 5 14 0 20000 0 0 empty empty empty -90 5 0 10 -262144
-1 -1 0 256;
#X text 294 174 fmin:;
#X text 294 150 freq:;
#X obj 338 118 bng 15 250 50 0 empty empty load 17 7 0 10 -262144 -1
-1;
#X obj 388 118 bng 15 250 50 0 empty empty export 17 7 0 10 -262144
-1 -1;
#N canvas -11 -11 1920 971 param 0;
#X obj 54 437 r compnum;
#X obj 54 466 i;
#X obj 54 495 clip 1 10;
#X obj 351 467 f;
#X obj 351 438 r ratio;
#X obj 228 224 mtof;
#X obj 228 253 expr $f1/max(pow($f2 \, $f3/2) \, 1e-20);
#X obj 228 125 r peak;
#X obj 228 154 EM_stom;
#X text 232 104 peak (symbol);
#X msg 479 493 1;
#X obj 779 435 r rest;
#X msg 779 493 0;
#X obj 54 131 r note;
#X obj 479 435 r note;
#X obj 351 496 clip 1 10;
#X obj 616 506 f;
#X obj 616 561 sel 1;
#X obj 616 535 == 0;
#X msg 502 573 1;
#X obj 479 464 t b b b;
#X obj 779 464 t b b;
#X msg 811 494 0;
#X text 50 413 Number of Components;
#X text 478 412 Gate Control;
#X text 745 591 <-reset phase if previous state is off;
#X obj 228 282 s SE_fmin;
#X obj 54 524 s SE_compnum;
#X obj 351 525 s SE_ratio;
#X obj 634 478 r SE_prev_state;
#X obj 616 590 s SE_phase_reset;
#X obj 502 602 s SE_prev_state;
#X obj 479 631 s SE_gate;
#X obj 811 523 s SE_prev_state;
#X text 747 253 <-using max() to avoid "expr divide by 0 detected"
;
#X obj 54 304 s SE_freq;
#X obj 548 224 mtof;
#X obj 599 224 t b f;
#X obj 681 224 t b f;
#X obj 548 125 r peak;
#X obj 548 154 EM_stom;
#X text 552 104 peak (symbol);
#X obj 599 195 r SE_ratio;
#X obj 681 195 r SE_compnum;
#X obj 548 253 expr $f1*pow($f2 \, $f3/2);
#X obj 548 282 s SE_fmax;
#X obj 217 467 f;
#X obj 217 496 clip 1 10;
#X text 220 417 CompRatio;
#X text 354 417 EnvRatio;
#X obj 217 525 s SE_compratio;
#X obj 320 224 t b f;
#X obj 445 224 t b f;
#X obj 320 195 r SE_ratio;
#X obj 445 195 r SE_compnum;
#X obj 217 438 r compratio;
#X obj 72 189 r SE_fmin;
#X obj 72 218 ftom;
#X obj 54 246 +;
#X obj 54 160 i;
#X obj 54 275 mtof;
#X text 55 108 note index / name;
#X text 68 38 This subpatch receives raw values from the qlist and
maps them to global parameters.;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 27 0;
#X connect 3 0 15 0;
#X connect 4 0 3 0;
#X connect 5 0 6 0;
#X connect 6 0 26 0;
#X connect 7 0 8 0;
#X connect 8 0 5 0;
#X connect 10 0 32 0;
#X connect 11 0 21 0;
#X connect 12 0 32 0;
#X connect 13 0 59 0;
#X connect 14 0 20 0;
#X connect 15 0 28 0;
#X connect 16 0 18 0;
#X connect 17 0 30 0;
#X connect 18 0 17 0;
#X connect 19 0 31 0;
#X connect 20 0 10 0;
#X connect 20 1 19 0;
#X connect 20 2 16 0;
#X connect 21 0 12 0;
#X connect 21 1 22 0;
#X connect 22 0 33 0;
#X connect 29 0 16 1;
#X connect 36 0 44 0;
#X connect 37 0 44 0;
#X connect 37 1 44 1;
#X connect 38 0 44 0;
#X connect 38 1 44 2;
#X connect 39 0 40 0;
#X connect 40 0 36 0;
#X connect 42 0 37 0;
#X connect 43 0 38 0;
#X connect 44 0 45 0;
#X connect 46 0 47 0;
#X connect 47 0 50 0;
#X connect 51 0 6 0;
#X connect 51 1 6 1;
#X connect 52 0 6 0;
#X connect 52 1 6 2;
#X connect 53 0 51 0;
#X connect 54 0 52 0;
#X connect 55 0 46 0;
#X connect 56 0 57 0;
#X connect 57 0 58 1;
#X connect 58 0 60 0;
#X connect 59 0 58 0;
#X connect 60 0 35 0;
#X coords 0 0 0.5 0.5 0 0 0;
#X restore 65 128 pd param;
#X obj 338 380 qlist;
#X obj 338 322 openpanel;
#X msg 338 351 read \$1;
#X msg 430 434 0;
#X obj 430 460 s rest;
#X obj 468 530 timer;
#X obj 445 341 t b b b;
#X obj 468 559 expr $f1*$f2/1000;
#X obj 584 502 loadbang;
#X obj 584 531 samplerate~;
#X msg 410 489 stop;
#X obj 370 406 t b b b b;
#X obj 415 646 soundfiler;
#X obj 370 532 savepanel;
#X obj 415 588 pack s f;
#X text 203 273 Component Amp(dB):;
#X obj 338 12 r SE_freq;
#X obj 338 41 r SE_fmin;
#X obj 491 369 tabwrite~ SE_recbuffer;
#X msg 415 617 write -wave -nframes \$2 \$1 SE_recbuffer;
#X obj 338 200 nbx 5 14 0 20000 0 0 empty empty empty -90 5 0 10 -262144
-1 -1 0 256;
#X text 294 198 fmax:;
#X obj 338 70 r SE_fmax;
#X obj 90 186 r gain;
#X obj 90 215 + 100;
#X obj 90 244 dbtorms;
#X obj 65 272 *~ 1;
#X symbolatom 338 248 7 0 0 0 - SE_note1_GUI -;
#X symbolatom 398 248 7 0 0 0 - SE_note2_GUI -;
#X symbolatom 458 248 7 0 0 0 - SE_note3_GUI -;
#X symbolatom 518 248 7 0 0 0 - SE_note4_GUI -;
#X symbolatom 578 248 7 0 0 0 - SE_note5_GUI -;
#X symbolatom 638 248 7 0 0 0 - SE_note6_GUI -;
#X text 224 247 Component Note:;
#X text 690 432 <-if qlist reaches the end of a file... \; 1: close
the envelope gate \; 2: stop recording \; 3: stop the timer and resize
the table \; 4: open a "save as" file browser \;;
#X connect 1 0 49 0;
#X connect 20 0 24 0;
#X connect 21 0 29 0;
#X connect 23 1 34 0;
#X connect 24 0 25 0;
#X connect 25 0 23 0;
#X connect 26 0 27 0;
#X connect 28 0 30 0;
#X connect 29 0 23 0;
#X connect 29 1 28 0;
#X connect 29 2 41 0;
#X connect 30 0 37 1;
#X connect 31 0 32 0;
#X connect 32 0 30 1;
#X connect 33 0 41 0;
#X connect 34 0 36 0;
#X connect 34 1 28 1;
#X connect 34 2 33 0;
#X connect 34 3 26 0;
#X connect 36 0 37 0;
#X connect 37 0 42 0;
#X connect 39 0 16 0;
#X connect 40 0 17 0;
#X connect 42 0 35 0;
#X connect 45 0 43 0;
#X connect 46 0 47 0;
#X connect 47 0 48 0;
#X connect 48 0 49 1;
#X connect 49 0 41 0;
#X connect 49 0 15 0;
#X coords 0 -1 1 1 500 200 1 200 100;
#X restore 45 50 pd main;
#X obj 44 331 *~;
#X obj 65 274 hsl 128 15 0 1 0 0 empty empty master_volume -2 -8 0
10 -262144 -1 -1 0 1;
#X obj 44 365 dac~;
#X text 41 406 Eito Murakami - A Complex Tone Generator based on Spectral
Envelope for Research on Pitch Perception;
#X obj 62 299 lop~ 100;
#X connect 0 0 1 0;
#X connect 1 0 3 0;
#X connect 1 0 3 1;
#X connect 2 0 5 0;
#X connect 5 0 1 1;
